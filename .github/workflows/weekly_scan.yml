name: Weekly Game Radar

# 触发条件
on:
  # 1. 定时触发：北京时间每周一上午 10:00 (UTC 时间 02:00)
  schedule:
    - cron: '0 2 * * 5'
  # 2. 手动触发：允许你在网页上点击 "Run workflow" 按钮随时测试
  workflow_dispatch:

# 权限设置：允许修改仓库内容（为了发布网页）
permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. 下载仓库代码
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. 安装 Python 3.9 环境
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3. 安装依赖库 (DuckDuckGo, OpenAI 等)
      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      # 4. 运行你的 main.py 脚本
      # 这里的 env 是把 Secret 里的密钥传递给脚本
      - name: Run Scan Script
        env:
          LLM_API_KEY: ${{ secrets.LLM_API_KEY }}
        run: python main.py

      # 5. 将生成的 index.html 发布到 GitHub Pages
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./
          keep_files: true
